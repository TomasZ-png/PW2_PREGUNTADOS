<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Preguntame</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="{{BASE_URL}}public/css/homeStyles.css">
</head>
<body>

<div class="home-wrapper">
    <!-- Header -->
    <header class="header-section">
        <div class="logo-header">
            <img src="{{BASE_URL}}public/img/preguntame-logo-solo.png" alt="Logo Preguntame">
            <h1>Preguntame</h1>
        </div>
{{#usuario}}
    {{^esEditor}}
            <h2 class="welcome-message">¬°Bienvenido, {{nombre_completo}}! üëã</h2>
            <p class="max-score">
                üèÜ M√°ximo puntaje obtenido:
                <span class="max-score-number">{{puntaje_maximo_obtenido}}</span>
            </p>
    {{/esEditor}}
{{/usuario}}

        {{#esEditor}}
            <h2 class="welcome-message">¬°Bienvenido, {{nombre_completo}}! üëã</h2>
            <p class="max-score">
                üèÜ Soy :
                <span class="max-score-number">El editor</span>
            </p>
        {{/esEditor}}

        <p class="subtitle">¬°Es hora de poner a prueba tu conocimiento!</p>
    </header>

    <!-- Contenido principal -->
    <main class="main-content">
        <!-- Secci√≥n de acciones -->
        <div class="actions-card">
            <h2><i class="material-icons">apps</i> Men√∫ Principal</h2>
            <div class="buttons-grid">
                {{#esEditor}}
                    <a href="{{BASE_URL}}EditorController/home" class="action-btn btn-editor">
                        <i class="material-icons">construction</i> Panel de Editor
                    </a>
                {{/esEditor}}

                {{#esAdmin}}
                    <a href="{{BASE_URL}}AdminController/dashboardGraficos" class="action-btn btn-admin">
                        <i class="material-icons">analytics</i> Ver Gr√°ficos
                    </a>
                {{/esAdmin}}

                {{^esEditor}}
                    <a href="{{BASE_URL}}PartidaController/iniciar" class="action-btn btn-play">
                        <i class="material-icons">play_circle</i> Jugar
                    </a>
                    <a href="{{BASE_URL}}PreguntaController/mostrarFormularioSugerir" class="action-btn btn-suggest">
                        <i class="material-icons">lightbulb</i> Sugerir Pregunta
                    </a>
                    {{#usuario}}
                    <a href="{{BASE_URL}}PerfilController/historial?id_usuario={{id_usuario}}" class="action-btn btn-admin">
                        <i class="material-icons">history</i> Historial de Partidas
                    </a>
                    {{/usuario}}
                {{/esEditor}}
            </div>
        </div>

        <!-- Ranking -->
        <div class="ranking-card">
            <h2><i class="material-icons">leaderboard</i> Ranking Global</h2>
            <ul class="ranking-list">
                {{#usuarios}}
                    <!-- Ingreso al Modal-->
                    <a href="#"
                       class="ranking-item"
                       data-id="{{id_usuario}}"
                       data-nombre="{{nombre_completo}}"
                       data-puntos="{{puntaje_maximo_obtenido}}"
                       data-qr="{{BASE_URL}}?controller=QRCodeController&method=generar&id={{id_usuario}}"
                    data-perfil="{{BASE_URL}}PerfilController/verPerfilPublico?id={{id_usuario}}"
                    data-bs-toggle="modal"
                    data-bs-target="#modalQR">

                    {{#foto_perfil}}
                        <img src="{{BASE_URL}}public/img/user-img/{{foto_perfil}}" class="ranking-avatar">
                    {{/foto_perfil}}

                    {{^foto_perfil}}
                        <img src="{{BASE_URL}}public/img/user-img/default-user.png" class="ranking-avatar">
                    {{/foto_perfil}}

                    <div class="ranking-info">
                        <span class="ranking-name">{{nombre_completo}}</span>
                    </div>

                    <span class="ranking-score">{{puntaje_maximo_obtenido}} pts</span>
                    </a>
                {{/usuarios}}

                {{^usuarios}}
                    <li class="no-users">A√∫n no hay jugadores en el ranking.</li>
                {{/usuarios}}
            </ul>
        </div>
    </main>
</div>

<!-- MODAL √öNICO -->
<div class="modal fade" id="modalQR" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <a href="#" class="modal-perfil-link" style="color: inherit; text-decoration: none;">
            <div class="modal-body text-center">
                <p class="modal-username fw-bold fs-4"></p>
                <p class="modal-puntos fs-5"></p>
                <img class="modal-qr img-fluid" style="max-width: 500px;">
            </div>
            </a>
        </div>
    </div>
</div>


<!-- Alertas -->
{{#error}}
    <div class="alert alert-danger" id="errorAlert">
        <i class="material-icons">cancel</i> {{error}}
    </div>
{{/error}}

{{#success}}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let msg = "";
            let emoji = "";

            if ("{{success}}" === "reporte_enviado") {
                emoji = "‚úÖ";
                msg = "¬°Reporte enviado con √©xito! Gracias por ayudarnos a mejorar el juego.";
            }

            if ("{{success}}" === "sugerencia_enviada") {
                emoji = "üéâ";
                msg = "¬°Sugerencia enviada correctamente! El equipo de editores la revisar√°.";
            }

            if (msg !== "") {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success';
                alertDiv.innerHTML = `${emoji} ${msg}`;
                document.body.appendChild(alertDiv);

                setTimeout(() => {
                    alertDiv.style.animation = 'slideOutRight 0.4s ease-out forwards';
                    setTimeout(() => alertDiv.remove(), 400);
                }, 4000);
            }
        });
    </script>
{{/success}}

<script>
    // Auto-cerrar alertas de error despu√©s de 5 segundos
    const errorAlert = document.getElementById('errorAlert');
    if (errorAlert) {
        setTimeout(() => {
            errorAlert.style.animation = 'slideOutRight 0.4s ease-out forwards';
            setTimeout(() => errorAlert.remove(), 400);
        }, 5000);
    }
</script>

<script>
    // Ingreso al Modal
    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("modalQR");

        modal.addEventListener("show.bs.modal", event => {
            const item = event.relatedTarget;

            const nombre = item.getAttribute("data-nombre");
            const qr = item.getAttribute("data-qr");
            const linkPerfil = item.getAttribute("data-perfil");
            const puntos = item.getAttribute("data-puntos");

            modal.querySelector(".modal-username").textContent = nombre;
            modal.querySelector(".modal-puntos").textContent = `${puntos} pts`;
            modal.querySelector(".modal-qr").src = qr;
            modal.querySelector(".modal-perfil-link").href = linkPerfil;

        });
    });
</script>

</body>
</html>